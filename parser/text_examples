"""
Test script to validate example FSAE telemetry JSON payloads
"""

import json
from validator import validate_payload

# List of example files to test
example_files = [
    'test_data/20220204_142345.json',
    'test_data/20220204_142412.json',
    'test_data/20220204_142503.json'
]

print("=" * 80)
print("FORMULA SAE TELEMETRY JSON VALIDATION TEST")
print("=" * 80)
print()

all_valid = True

for filename in example_files:
    print(f"Testing: {filename}")
    print("-" * 80)
    
    try:
        # Read the JSON file
        with open(filename, 'r') as f:
            payload = json.load(f)
        
        # Validate the payload
        is_valid, errors = validate_payload(payload)
        
        if is_valid:
            print(f"✓ VALID - Telemetry payload passed all validation checks")
            
            # Show summary of what was validated
            print(f"  Timestamp: {payload['timestamp']}")
            print(f"  Session ID: {payload['session_id']}")
            print(f"  Vehicle ID: {payload['vehicle_id']}")
            print(f"  Engine RPM: {payload['sensors']['engine_rpm']}")
            print(f"  Throttle Position: {payload['sensors']['throttle_position']}%")
            print(f"  Brake Pressure: {payload['sensors']['brake_pressure']} psi")
            print(f"  Speed (FL/FR/RL/RR): {payload['sensors']['speed_fl']}/{payload['sensors']['speed_fr']}/{payload['sensors']['speed_rl']}/{payload['sensors']['speed_rr']} mph")
            print(f"  Lateral G: {payload['sensors']['accel_lateral']}g")
            print(f"  Sample Rate: {payload['telemetry_metadata']['sample_rate_hz']} Hz")
            print(f"  DAQ Version: {payload['telemetry_metadata']['daq_version']}")
        else:
            print(f"✗ INVALID - Validation failed with {len(errors)} error(s):")
            for i, error in enumerate(errors, 1):
                print(f"  {i}. {error}")
            all_valid = False
    
    except FileNotFoundError:
        print(f"✗ ERROR - File not found: {filename}")
        all_valid = False
    except json.JSONDecodeError as e:
        print(f"✗ ERROR - Invalid JSON format: {e}")
        all_valid = False
    except Exception as e:
        print(f"✗ ERROR - Unexpected error: {e}")
        all_valid = False
    
    print()

print("=" * 80)
if all_valid:
    print("✓ ALL EXAMPLE TELEMETRY PAYLOADS PASSED VALIDATION")
    print("Ready for data pipeline ingestion!")
else:
    print("✗ SOME PAYLOADS FAILED VALIDATION")
    print("Please fix errors before pipeline ingestion.")
print("=" * 80)